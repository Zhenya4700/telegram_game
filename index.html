<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–ø–∞–ª–∫–∞ —á–ª–µ–Ω–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            color: white;
            transition: background 0.5s ease, box-shadow 0.5s ease;
        }

        body.bg-default {
            background: linear-gradient(145deg, #1a1e2c 0%, #2a2f42 100%);
        }

        body.bg-neon {
            background: linear-gradient(145deg, #20002c, #6a1b9a);
        }

        body.bg-gold {
            background: linear-gradient(145deg, #7d6608, #b8860b);
        }

        body.bg-rainbow {
            background: linear-gradient(145deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            background-size: 400% 400%;
            animation: rainbow 10s ease infinite;
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body.bg-dark {
            background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
        }

        body.bg-forest {
            background: linear-gradient(145deg, #1b4d1b, #2e7d32);
        }

        body.bg-ocean {
            background: linear-gradient(145deg, #01579b, #0288d1);
        }

        body.bg-lava {
            background: linear-gradient(145deg, #bf360c, #d84315);
        }

        .game-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 48px;
            padding: 32px 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 90%;
            max-width: 380px;
            text-align: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 40px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff99cc, #b3d9ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: #1a1e2c;
        }

        .username {
            font-weight: 600;
            flex: 1;
            text-align: left;
        }

        .stars {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(147, 112, 219, 0.15);
            padding: 5px 10px;
            border-radius: 30px;
            border: 1px solid rgba(147, 112, 219, 0.3);
        }

        .star-icon {
            font-size: 16px;
        }

        .star-amount {
            font-weight: 600;
            color: #c0a0ff;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ff99cc, #b3d9ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #ffd966;
        }

        .tap-area {
            width: 200px;
            height: 200px;
            margin: 15px auto 20px;
            background: radial-gradient(circle at 30% 30%, #ffd966, #e68a2e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 15px 0 #b3540b, 0 20px 30px rgba(0, 0, 0, 0.6);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 3px solid #ffb347;
            position: relative;
        }

        .tap-area:active {
            transform: translateY(8px) scale(0.95);
            box-shadow: 0 8px 0 #b3540b, 0 15px 25px rgba(0, 0, 0, 0.6);
            transition: all 0.1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .tap-area.cooldown {
            opacity: 0.5;
            filter: grayscale(80%);
            cursor: not-allowed;
            pointer-events: none;
            transform: translateY(5px) scale(0.98);
            box-shadow: 0 5px 0 #7a4a1f;
            transition: all 0.3s ease;
        }

        .tap-area.ready {
            animation: smoothPulse 2s ease-in-out infinite;
        }

        @keyframes smoothPulse {
            0% {
                box-shadow: 0 15px 0 #b3540b, 0 20px 30px rgba(0, 0, 0, 0.6);
            }
            50% {
                box-shadow: 0 15px 0 #b3540b, 0 20px 30px rgba(0, 0, 0, 0.6), 0 0 30px #ffd966;
            }
            100% {
                box-shadow: 0 15px 0 #b3540b, 0 20px 30px rgba(0, 0, 0, 0.6);
            }
        }

        .size-display {
            font-size: 4rem;
            font-weight: 900;
            color: #ffe484;
            text-shadow: 0 3px 0 #b3540b, 0 5px 15px black;
            line-height: 1;
            margin-bottom: 5px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: inline-block;
            animation: sizePop 0.4s ease-out;
        }

        @keyframes sizePop {
            0% {
                transform: scale(0.8) translateY(20px);
                opacity: 0;
            }
            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .size-label {
            font-size: 1.5rem;
            color: #f5c6a0;
            margin-bottom: 5px;
        }

        .change-indicator {
            font-size: 2rem;
            font-weight: bold;
            min-height: 50px;
            margin: 5px 0;
            animation: floatChange 0.8s ease-out forwards;
        }

        @keyframes floatChange {
            0% {
                transform: scale(0.5) translateY(20px);
                opacity: 0;
            }
            30% {
                transform: scale(1.2) translateY(-5px);
                opacity: 1;
            }
            70% {
                transform: scale(1) translateY(-10px);
                opacity: 0.8;
            }
            100% {
                transform: scale(0.8) translateY(-30px);
                opacity: 0;
            }
        }

        .positive { color: #4caf50; text-shadow: 0 0 15px rgba(76, 175, 80, 0.5); }
        .negative { color: #f44336; text-shadow: 0 0 15px rgba(244, 67, 54, 0.5); }

        .timer-text {
            font-size: 1.3rem;
            background: rgba(0, 0, 0, 0.4);
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-block;
            color: #aaa;
            border: 1px solid #444;
            margin: 15px 0;
            font-family: monospace;
            letter-spacing: 2px;
            transition: all 0.3s ease;
        }

        .timer-text.active {
            color: #ffd966;
            border-color: #ffd966;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            animation: timerGlow 1s ease-in-out infinite;
        }

        @keyframes timerGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.6); }
        }

        .error-message {
            color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 14px;
            display: none;
            animation: shake 0.4s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }

        .loading {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #1a1e2c;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #3a3f55;
            border-top-color: #ffd966;
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .nav-menu {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: #8e94ab;
            font-size: 0.9rem;
            padding: 8px 0;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            flex: 1;
            border-radius: 20px;
        }

        .nav-btn.active {
            color: #ffd966;
            background: rgba(255, 215, 0, 0.1);
        }

        .nav-icon {
            font-size: 1.5rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .leaderboard-rank {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #ffd966, #e68a2e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1a1e2c;
        }

        .leaderboard-rank-1 { background: linear-gradient(135deg, #ffd700, #ffa500); }
        .leaderboard-rank-2 { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); }
        .leaderboard-rank-3 { background: linear-gradient(135deg, #cd7f32, #b06d2a); }

        .leaderboard-name {
            flex: 1;
            text-align: left;
            font-weight: 500;
        }

        .leaderboard-size {
            font-weight: bold;
            color: #ffd966;
        }

        .leaderboard-you {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .refresh-btn:active {
            transform: rotate(180deg);
            background: rgba(255, 215, 0, 0.2);
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shop-item-info {
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shop-item-icon {
            font-size: 2.5rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .shop-item-text {
            text-align: left;
        }

        .shop-item-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .shop-item-desc {
            font-size: 0.8rem;
            color: #8e94ab;
        }

        .shop-item-price {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(147, 112, 219, 0.15);
            padding: 5px 10px;
            border-radius: 20px;
        }

        .buy-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 2px solid #2e7d32;
            transition: all 0.1s ease;
        }

        .buy-btn:active {
            transform: translateY(2px);
            border-bottom-width: 0;
        }

        .buy-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background: #7f8c8d;
            border-bottom-color: #4a4a4a;
        }

        .current-skin {
            font-size: 0.9rem;
            color: #ffd966;
            margin: 10px 0;
            padding: 5px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 20px;
        }

        .cooldown-reset {
            background: linear-gradient(145deg, #ff6b6b, #ff4757);
            margin-top: 15px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .inventory-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .inventory-item.owned {
            border-color: #ffd966;
            background: rgba(255, 215, 0, 0.1);
        }

        .inventory-item.default {
            border-color: #ffffff;
            background: rgba(255, 255, 255, 0.15);
        }

        .inventory-item-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .inventory-item-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .inventory-item-controls {
            display: flex;
            gap: 5px;
            justify-content: center;
            min-height: 40px;
            align-items: center;
        }

        .inv-btn {
            background: #3a3f55;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            border-bottom: 2px solid #1e2230;
            transition: all 0.1s ease;
        }

        .inv-btn:active {
            transform: translateY(2px);
            border-bottom-width: 0;
        }

        .equipped-badge {
            color: #4caf50;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(76, 175, 80, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .sold-out {
            color: #ff6b6b;
            font-size: 0.8rem;
            margin-top: 4px;
        }
    </style>
</head>
<body class="bg-default" id="body">
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
    </div>

    <div class="game-container" id="gameContent" style="display: none;">
        <div class="user-info">
            <div class="avatar" id="avatar">üë§</div>
            <div class="username" id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="stars" id="starsDisplay">
                <span class="star-icon">‚≠ê</span>
                <span class="star-amount" id="starAmount">20</span>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Ç–∞–ø–∞–ª–∫–∞) -->
        <div class="page active" id="homePage">
            <h1>‚ö° MEM-–º–µ—Ç—Ä ‚ö°</h1>

            <div class="tap-area default" id="tapCircle"></div>
            
            <div class="size-display" id="sizeValue">0</div>
            <div class="size-label">—Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–æ–≤</div>
            <div class="change-indicator" id="changeIndicator"></div>
            
            <div class="timer-text" id="timerDisplay">‚ö° –≥–æ—Ç–æ–≤ ‚ö°</div>
            
            <div class="error-message" id="errorMessage"></div>
        </div>

        <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ -->
        <div class="page" id="leaderboardPage">
            <div class="leaderboard-header">
                <h2>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
                <button class="refresh-btn" onclick="updateLeaderboard()">üîÑ</button>
            </div>
            <div id="leaderboardList">
                <div style="text-align: center; color: #8e94ab; padding: 20px;">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–æ–≤...
                </div>
            </div>
        </div>

        <!-- –ú–∞–≥–∞–∑–∏–Ω -->
        <div class="page" id="shopPage">
            <h2 style="margin-bottom: 20px;">üè™ –ú–∞–≥–∞–∑–∏–Ω —á–ª–µ–Ω–æ–≤</h2>
            
            <div class="current-skin" id="currentSkinDisplay">–¢–µ–∫—É—â–∏–π —Ñ–æ–Ω: –û–±—ã—á–Ω—ã–π</div>
            
            <div style="margin-bottom: 15px; font-size: 0.9rem; color: #8e94ab; text-align: left;">
                –ü–æ–∫—É–ø–∞–π —Ñ–æ–Ω—ã –∑–∞ –∑–≤—ë–∑–¥—ã ‚≠ê (—Ç–µ—Å—Ç: 20 ‚≠ê –Ω–µ —Ç—Ä–∞—Ç—è—Ç—Å—è)
            </div>
            
            <!-- –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞ -->
            <div class="shop-item cooldown-reset">
                <div class="shop-item-info">
                    <div class="shop-item-icon">‚è±Ô∏è</div>
                    <div class="shop-item-text">
                        <div class="shop-item-title">–°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞</div>
                        <div class="shop-item-desc">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç 100 —Å–µ–∫—É–Ω–¥</div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="shop-item-price">
                        <span>‚≠ê</span>
                        <span>0</span>
                    </div>
                    <button class="buy-btn" onclick="resetCooldown()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>
            
            <div id="shopItems">
                <!-- –°—é–¥–∞ –±—É–¥—É—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Å–∫–∏–Ω—ã -->
            </div>
        </div>

        <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div class="page" id="inventoryPage">
            <h2 style="margin-bottom: 20px;">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
            
            <div class="current-skin" id="inventoryCurrentSkin">–¢–µ–∫—É—â–∏–π —Ñ–æ–Ω: –û–±—ã—á–Ω—ã–π</div>
            
            <div class="inventory-grid" id="inventoryGrid">
                <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é -->
        <div class="nav-menu">
            <button class="nav-btn active" id="navHome" onclick="switchPage('home')">
                <span class="nav-icon">üè†</span>
                <span>–î–æ–º</span>
            </button>
            <button class="nav-btn" id="navLeaderboard" onclick="switchPage('leaderboard')">
                <span class="nav-icon">üèÜ</span>
                <span>–¢–æ–ø</span>
            </button>
            <button class="nav-btn" id="navShop" onclick="switchPage('shop')">
                <span class="nav-icon">üè™</span>
                <span>–ú–∞–≥–∞–∑–∏–Ω</span>
            </button>
            <button class="nav-btn" id="navInventory" onclick="switchPage('inventory')">
                <span class="nav-icon">üéí</span>
                <span>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
            </button>
        </div>
    </div>

    <script>
        // ==================================
        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø - –§–û–ù–´ –°–û–•–†–ê–ù–Ø–Æ–¢–°–Ø
        // ==================================

        const API_URL = 'https://zhenya4700.pythonanywhere.com';
        const COOLDOWN_SECONDS = 100;
        const MIN_SIZE = -10;
        
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        let user = tg.initDataUnsafe?.user;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const body = document.getElementById('body');
        const loading = document.getElementById('loading');
        const gameContent = document.getElementById('gameContent');
        const avatar = document.getElementById('avatar');
        const usernameEl = document.getElementById('username');
        const sizeEl = document.getElementById('sizeValue');
        const changeEl = document.getElementById('changeIndicator');
        const timerEl = document.getElementById('timerDisplay');
        const errorEl = document.getElementById('errorMessage');
        const circle = document.getElementById('tapCircle');
        const starAmountEl = document.getElementById('starAmount');
        const currentSkinDisplay = document.getElementById('currentSkinDisplay');
        const inventoryCurrentSkin = document.getElementById('inventoryCurrentSkin');
        const inventoryGrid = document.getElementById('inventoryGrid');
        const shopItems = document.getElementById('shopItems');
        
        // –°—Ç—Ä–∞–Ω–∏—Ü—ã
        const pages = {
            home: document.getElementById('homePage'),
            leaderboard: document.getElementById('leaderboardPage'),
            shop: document.getElementById('shopPage'),
            inventory: document.getElementById('inventoryPage')
        };
        
        const navBtns = {
            home: document.getElementById('navHome'),
            leaderboard: document.getElementById('navLeaderboard'),
            shop: document.getElementById('navShop'),
            inventory: document.getElementById('navInventory')
        };
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let size = 0;
        let lastClickTime = 0;
        let cooldown = false;
        let timerInterval = null;
        let currentBackground = 'default';
        let ownedSkins = new Set(['default']); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ–Ω
        
        // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–∫–∏–Ω–æ–≤ —Å –∏–∫–æ–Ω–∫–∞–º–∏
        const allSkins = [
            { id: 'neon', name: '–ù–µ–æ–Ω–æ–≤—ã–π —á–ª–µ–Ω', desc: '–§–∏–æ–ª–µ—Ç–æ–≤–æ–µ –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–∏—è–Ω–∏–µ', icon: 'üíú' },
            { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π —á–ª–µ–Ω', desc: '–†–æ—Å–∫–æ—à–Ω—ã–π –∑–æ–ª–æ—Ç–æ–π —Ñ–æ–Ω', icon: 'üíõ' },
            { id: 'rainbow', name: '–†–∞–¥—É–∂–Ω—ã–π —á–ª–µ–Ω', desc: '–ü–µ—Ä–µ–ª–∏–≤–∞—é—â–∏–π—Å—è —Ä–∞–¥—É–∂–Ω—ã–π —Ñ–æ–Ω', icon: 'üåà' },
            { id: 'dark', name: '–¢—ë–º–Ω—ã–π —á–ª–µ–Ω', desc: '–ó–ª–æ–≤–µ—â–∏–π —Ç—ë–º–Ω—ã–π —Ñ–æ–Ω', icon: 'üñ§' },
            { id: 'forest', name: '–õ–µ—Å–Ω–æ–π —á–ª–µ–Ω', desc: '–ó–µ–ª—ë–Ω—ã–π –ª–µ—Å–Ω–æ–π —Ñ–æ–Ω', icon: 'üå≤' },
            { id: 'ocean', name: '–û–∫–µ–∞–Ω—Å–∫–∏–π —á–ª–µ–Ω', desc: '–ì–ª—É–±–æ–∫–∏–π —Å–∏–Ω–∏–π –æ–∫–µ–∞–Ω', icon: 'üåä' },
            { id: 'lava', name: '–õ–∞–≤–æ–≤—ã–π —á–ª–µ–Ω', desc: '–û–≥–Ω–µ–Ω–Ω—ã–π –ª–∞–≤–æ–≤—ã–π —Ñ–æ–Ω', icon: 'üåã' }
        ];
        
        // –ù–∞–∑–≤–∞–Ω–∏—è —Ñ–æ–Ω–æ–≤
        const backgroundNames = {
            'default': '–û–±—ã—á–Ω—ã–π',
            'neon': '–ù–µ–æ–Ω–æ–≤—ã–π',
            'gold': '–ó–æ–ª–æ—Ç–æ–π',
            'rainbow': '–†–∞–¥—É–∂–Ω—ã–π',
            'dark': '–¢—ë–º–Ω—ã–π',
            'forest': '–õ–µ—Å–Ω–æ–π',
            'ocean': '–û–∫–µ–∞–Ω—Å–∫–∏–π',
            'lava': '–õ–∞–≤–æ–≤—ã–π'
        };
        
        // –ò–∫–æ–Ω–∫–∏ —Ñ–æ–Ω–æ–≤
        const backgroundIcons = {
            'default': '‚ö™',
            'neon': 'üíú',
            'gold': 'üíõ',
            'rainbow': 'üåà',
            'dark': 'üñ§',
            'forest': 'üå≤',
            'ocean': 'üåä',
            'lava': 'üåã'
        };
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function updateStars() {
            starAmountEl.textContent = '20';
        }
        
        function updateCurrentSkinDisplay() {
            const icon = backgroundIcons[currentBackground] || '‚ö™';
            const text = `–¢–µ–∫—É—â–∏–π —Ñ–æ–Ω: ${icon} ${backgroundNames[currentBackground]}`;
            if (currentSkinDisplay) currentSkinDisplay.textContent = text;
            if (inventoryCurrentSkin) inventoryCurrentSkin.textContent = text;
        }
        
        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω
        function applyBackground(bgName) {
            console.log('Applying background:', bgName);
            currentBackground = bgName;
            body.className = '';
            body.classList.add(`bg-${bgName}`);
            updateCurrentSkinDisplay();
            updateInventoryDisplay(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–¥–µ—Ç—å"
            saveToServer(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
        function updateShop() {
            let html = '';
            for (let skin of allSkins) {
                const isOwned = ownedSkins.has(skin.id);
                html += `
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-icon">${skin.icon}</div>
                            <div class="shop-item-text">
                                <div class="shop-item-title">${skin.name}</div>
                                <div class="shop-item-desc">${skin.desc}</div>
                                ${isOwned ? '<div class="sold-out">‚úÖ –£–∂–µ –∫—É–ø–ª–µ–Ω–æ</div>' : ''}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="shop-item-price">
                                <span>‚≠ê</span>
                                <span>1</span>
                            </div>
                            <button class="buy-btn" onclick="buyBackground('${skin.id}')" ${isOwned ? 'disabled' : ''}>
                                ${isOwned ? '–ö—É–ø–ª–µ–Ω–æ' : '–ö—É–ø–∏—Ç—å'}
                            </button>
                        </div>
                    </div>
                `;
            }
            shopItems.innerHTML = html;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function updateInventoryDisplay() {
            if (!inventoryGrid) return;
            
            let html = '';
            
            // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ–Ω
            const isDefaultActive = (currentBackground === 'default');
            html += `
                <div class="inventory-item default">
                    <div class="inventory-item-icon">‚ö™</div>
                    <div class="inventory-item-title">–û–±—ã—á–Ω—ã–π</div>
                    <div class="inventory-item-controls">
                        ${!isDefaultActive ? 
                            `<button class="inv-btn" onclick="applyBackground('default')">–ù–∞–¥–µ—Ç—å</button>` : 
                            '<span class="equipped-badge">‚úÖ –ù–∞–¥–µ—Ç–æ</span>'}
                    </div>
                </div>
            `;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—É–ø–ª–µ–Ω–Ω—ã–µ —Å–∫–∏–Ω—ã
            for (let skin of allSkins) {
                if (ownedSkins.has(skin.id)) {
                    const isActive = (currentBackground === skin.id);
                    html += `
                        <div class="inventory-item owned">
                            <div class="inventory-item-icon">${skin.icon}</div>
                            <div class="inventory-item-title">${skin.name.replace(' —á–ª–µ–Ω', '')}</div>
                            <div class="inventory-item-controls">
                                ${!isActive ? 
                                    `<button class="inv-btn" onclick="applyBackground('${skin.id}')">–ù–∞–¥–µ—Ç—å</button>` : 
                                    '<span class="equipped-badge">‚úÖ –ù–∞–¥–µ—Ç–æ</span>'}
                            </div>
                        </div>
                    `;
                }
            }
            
            if (ownedSkins.size <= 1) { // –¢–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ–Ω
                html += '<div style="grid-column: span 2; text-align: center; color: #8e94ab; padding: 20px;">–£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>';
            }
            
            inventoryGrid.innerHTML = html;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
        window.switchPage = function(page) {
            Object.values(pages).forEach(p => p.classList.remove('active'));
            Object.values(navBtns).forEach(b => b.classList.remove('active'));
            
            pages[page].classList.add('active');
            navBtns[page].classList.add('active');
            
            if (page === 'leaderboard') {
                updateLeaderboard();
            } else if (page === 'inventory') {
                updateInventoryDisplay();
            } else if (page === 'shop') {
                updateShop();
            }
        };
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
        window.updateLeaderboard = async function() {
            const listEl = document.getElementById('leaderboardList');
            listEl.innerHTML = '<div style="text-align: center; color: #8e94ab; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            try {
                const response = await fetch(`${API_URL}/api/leaderboard`);
                const leaders = await response.json();
                
                if (leaders.length === 0) {
                    listEl.innerHTML = '<div style="text-align: center; color: #8e94ab; padding: 20px;">–ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</div>';
                    return;
                }
                
                listEl.innerHTML = leaders.map((item, index) => {
                    const isYou = user && item.telegram_id === String(user.id);
                    const rankClass = index === 0 ? 'leaderboard-rank-1' : (index === 1 ? 'leaderboard-rank-2' : (index === 2 ? 'leaderboard-rank-3' : ''));
                    
                    return `
                        <div class="leaderboard-item ${isYou ? 'leaderboard-you' : ''}">
                            <div class="leaderboard-rank ${rankClass}">${index + 1}</div>
                            <div class="leaderboard-name">${item.name} ${isYou ? '(—Ç—ã)' : ''}</div>
                            <div class="leaderboard-size">${item.size} —Å–º</div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Leaderboard error:', error);
                listEl.innerHTML = '<div style="text-align: center; color: #f44336; padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        };
        
        // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
        window.resetCooldown = function() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            cooldown = false;
            lastClickTime = 0;
            circle.classList.remove('cooldown');
            circle.classList.add('ready');
            timerEl.textContent = '‚ö° –≥–æ—Ç–æ–≤ ‚ö°';
            timerEl.classList.remove('active');
        };
        
        // –ü–æ–∫—É–ø–∫–∞ —Ñ–æ–Ω–∞
        window.buyBackground = function(skinId) {
            console.log('Buying skin:', skinId);
            if (!ownedSkins.has(skinId)) {
                ownedSkins.add(skinId);
                console.log('Owned skins now:', Array.from(ownedSkins));
                updateShop();
                updateInventoryDisplay();
                saveToServer(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –≤ —Ç–∞–±–ª–∏—Ü—É
            }
        };
        
        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        async function auth() {
            try {
                console.log('Auth started');
                const response = await fetch(`${API_URL}/api/auth`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        telegram_id: String(user.id),
                        username: user.username || '',
                        first_name: user.first_name || ''
                    })
                });
                
                const data = await response.json();
                console.log('Auth response:', data);
                
                size = data.size || 0;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—É–ø–ª–µ–Ω–Ω—ã–µ —Å–∫–∏–Ω—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
                if (data.ownedSkins && Array.isArray(data.ownedSkins)) {
                    ownedSkins = new Set(data.ownedSkins);
                }
                ownedSkins.add('default'); // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ–Ω –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å
                console.log('Loaded owned skins:', Array.from(ownedSkins));
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–æ–Ω –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
                if (data.background) {
                    currentBackground = data.background;
                } else {
                    currentBackground = 'default';
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ–Ω
                body.className = '';
                body.classList.add(`bg-${currentBackground}`);
                updateCurrentSkinDisplay();
                
                if (data.last_click) {
                    lastClickTime = new Date(data.last_click).getTime();
                }
                
                updateSize();
                updateStars();
                checkCooldown();
                
                loading.style.display = 'none';
                gameContent.style.display = 'block';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
                updateShop();
                updateInventoryDisplay();
                
            } catch (error) {
                console.error('Auth error:', error);
                loading.style.display = 'none';
                gameContent.style.display = 'block';
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–≤ —Ç–∞–±–ª–∏—Ü—É)
        async function saveToServer() {
            if (!user) return;
            
            const saveData = {
                telegram_id: String(user.id),
                size: size,
                background: currentBackground,
                ownedSkins: Array.from(ownedSkins)
            };
            console.log('Saving to server:', saveData);
            
            try {
                const response = await fetch(`${API_URL}/api/update`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(saveData)
                });
                const result = await response.json();
                console.log('Save result:', result);
            } catch (error) {
                console.error('Save error:', error);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞
        function checkCooldown() {
            const now = Date.now();
            const diff = (now - lastClickTime) / 1000;
            
            if (diff < COOLDOWN_SECONDS && lastClickTime > 0) {
                startCooldown(COOLDOWN_SECONDS - diff);
            } else {
                circle.classList.remove('cooldown');
                circle.classList.add('ready');
                timerEl.textContent = '‚ö° –≥–æ—Ç–æ–≤ ‚ö°';
                timerEl.classList.remove('active');
                cooldown = false;
            }
        }
        
        function startCooldown(seconds) {
            cooldown = true;
            circle.classList.add('cooldown');
            circle.classList.remove('ready');
            
            let timeLeft = seconds;
            
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                
                if (timeLeft <= 0.05) {
                    clearInterval(timerInterval);
                    cooldown = false;
                    circle.classList.remove('cooldown');
                    circle.classList.add('ready');
                    timerEl.textContent = '‚ö° –≥–æ—Ç–æ–≤ ‚ö°';
                    timerEl.classList.remove('active');
                } else {
                    const mins = Math.floor(timeLeft / 60);
                    const secs = Math.floor(timeLeft % 60);
                    timerEl.textContent = `‚è≥ ${mins}:${secs < 10 ? '0' : ''}${secs}`;
                    timerEl.classList.add('active');
                }
            }, 100);
        }
        
        // –ö–ª–∏–∫
        async function handleTap() {
            if (cooldown) return;
            
            try {
                const response = await fetch(`${API_URL}/api/click`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({telegram_id: String(user.id)})
                });
                
                const data = await response.json();
                
                if (response.status === 429) {
                    startCooldown(data.wait);
                    return;
                }
                
                circle.style.transform = 'translateY(8px) scale(0.95)';
                setTimeout(() => {
                    circle.style.transform = '';
                }, 100);
                
                size = Math.max(MIN_SIZE, data.size);
                
                sizeEl.style.animation = 'none';
                sizeEl.offsetHeight;
                sizeEl.style.animation = 'sizePop 0.4s ease-out';
                
                updateSize();
                showChange(data.change);
                startCooldown(COOLDOWN_SECONDS);
                
            } catch (error) {
                console.error('Click error:', error);
            }
        }
        
        function updateSize() {
            sizeEl.textContent = size;
        }
        
        function showChange(change) {
            changeEl.innerHTML = '';
            changeEl.style.animation = 'none';
            changeEl.offsetHeight;
            
            if (change > 0) {
                changeEl.innerHTML = `<span class="positive">+${change}</span>`;
            } else if (change < 0) {
                changeEl.innerHTML = `<span class="negative">${change}</span>`;
            } else {
                changeEl.innerHTML = `<span>0</span>`;
            }
            
            changeEl.style.animation = 'floatChange 0.8s ease-out forwards';
        }
        
        // –ó–∞–ø—É—Å–∫
        if (!user) {
            usernameEl.textContent = '–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º';
            avatar.textContent = 'üë§';
            loading.style.display = 'none';
            gameContent.style.display = 'block';
            circle.classList.add('ready');
        } else {
            usernameEl.textContent = user.first_name || user.username || '–ò–≥—Ä–æ–∫';
            avatar.textContent = (user.first_name ? user.first_name[0] : 'üë§').toUpperCase();
            auth();
        }
        
        circle.addEventListener('click', handleTap);
        
        window.addEventListener('beforeunload', function() {
            saveToServer();
        });
    </script>
</body>
</html>
