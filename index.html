<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Telegram Stars</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 16px;
        }
        
        .container {
            max-width: 400px;
            width: 100%;
            background: #1c1c1e;
            border-radius: 24px;
            padding: 24px;
        }
        
        h1 {
            color: #ffd966;
            text-align: center;
            margin-bottom: 24px;
        }
        
        .balance {
            background: #2c2c2e;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .stars-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 24px;
            font-weight: bold;
            color: #ffd966;
        }
        
        button {
            background: #ffd966;
            color: black;
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-bottom: 12px;
            cursor: pointer;
        }
        
        button.secondary {
            background: #2c2c2e;
            color: #ffd966;
            border: 1px solid #ffd966;
        }
        
        .log {
            background: #2c2c2e;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 14px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .success { color: #30d158; }
        .error { color: #ff453a; }
        
        .info-box {
            background: rgba(255, 149, 0, 0.2);
            border: 1px solid #ff9500;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 16px;
            color: #ff9500;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚≠êÔ∏è Telegram Stars</h1>
        
        <div class="info-box" id="info">
            üîÑ –ó–∞–≥—Ä—É–∂–∞—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é...
        </div>
        
        <div class="balance">
            <span>–ë–∞–ª–∞–Ω—Å:</span>
            <div class="stars-display">
                <span>‚≠êÔ∏è</span>
                <span id="balance">0</span>
            </div>
        </div>
        
        <button id="buyBtn">üí∞ –ö—É–ø–∏—Ç—å 1 –∑–≤–µ–∑–¥—É</button>
        <button class="secondary" id="spendBtn">üéÆ –ü–æ—Ç—Ä–∞—Ç–∏—Ç—å 1 –∑–≤–µ–∑–¥—É</button>
        <button class="secondary" id="checkBtn">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        
        <div class="log" id="log">
            <div>üëã –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç—É</div>
        </div>
        
        <div style="font-size: 12px; color: #666; text-align: center; margin-top: 16px;">
            Bot: <span id="botName">–∑–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
        const initData = tg.initDataUnsafe || {};
        const botName = initData.bot?.username || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        const user = initData.user;
        
        document.getElementById('botName').textContent = '@' + botName;
        document.getElementById('info').innerHTML = `‚úÖ –ë–æ—Ç: @${botName}<br>ID: ${user?.id || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`;
        
        let stars = 0;
        
        function log(msg, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        }
        
        function updateBalance(amount) {
            stars = amount;
            document.getElementById('balance').textContent = stars;
        }
        
        // –ü–†–ê–í–ò–õ–¨–ù–´–ô –°–ü–û–°–û–ë 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º createInvoiceLink —á–µ—Ä–µ–∑ –±—ç–∫–µ–Ω–¥
        async function buyStarViaBackend() {
            log('üîÑ –ó–∞–ø—Ä–∞—à–∏–≤–∞—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É...');
            
            try {
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É –±—ç–∫–µ–Ω–¥—É, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—Å—Ç –∏–Ω–≤–æ–π—Å
                // –ù–æ –¥–ª—è —Ç–µ—Å—Ç–∞ –ø–æ–∫–∞–∂–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
                log('‚ùå –ù—É–∂–µ–Ω –±—ç–∫–µ–Ω–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞', 'error');
                
                // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º–æ–π –º–µ—Ç–æ–¥ (—Å–º. –Ω–∏–∂–µ)
                alternativeBuyMethod();
                
            } catch (e) {
                log(`–û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ô –ú–ï–¢–û–î: –ò—Å–ø–æ–ª—å–∑—É–µ–º stars@pay (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
        function alternativeBuyMethod() {
            log('üîÑ –ü—Ä–æ–±—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥...');
            
            // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ stars –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É
            const invoiceLink = `https://t.me/stars?startapp=transfer&amount=1&text=–¢–µ—Å—Ç–æ–≤–∞—è%20–ø–æ–∫—É–ø–∫–∞`;
            
            tg.openTelegramLink(invoiceLink);
            
            log('üì± –û—Ç–∫—Ä—ã—Ç–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ', 'info');
            log('üí° –ü–æ—Å–ª–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"');
        }
        
        // –ü–†–ê–í–ò–õ–¨–ù–´–ô –ú–ï–¢–û–î: –ß–µ—Ä–µ–∑ –±—ç–∫–µ–Ω–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
        async function correctBuyMethod() {
            log('üîÑ –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');
            
            // –≠–º—É–ª–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å fetch –∫ –≤–∞—à–µ–º—É API
            setTimeout(() => {
                // –°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
                const invoiceUrl = "https://t.me/$invoice_token"; // –ü—Ä–∏–º–µ—Ä
                
                log('‚úÖ –ü–æ–ª—É—á–µ–Ω –∏–Ω–≤–æ–π—Å –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞', 'success');
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∏–Ω–≤–æ–π—Å
                tg.openInvoice(invoiceUrl, (status) => {
                    log(`üì¶ –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã: ${status}`);
                    
                    if (status === 'paid') {
                        updateBalance(stars + 1);
                        log('‚úÖ –ó–≤–µ–∑–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!', 'success');
                        tg.showAlert('–°–ø–∞—Å–∏–±–æ! –ó–≤–µ–∑–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ ‚≠êÔ∏è');
                    }
                });
                
            }, 1000);
        }
        
        // –í–†–ï–ú–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
        document.getElementById('buyBtn').onclick = () => {
            log('‚ÑπÔ∏è –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –æ–ø–ª–∞—Ç—ã –Ω—É–∂–Ω–æ:', 'info');
            log('1. –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å —á–µ—Ä–µ–∑ –±–æ—Ç–∞ (–º–µ—Ç–æ–¥ createInvoiceLink)', 'info');
            log('2. –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –≤–∏–¥–∞ https://t.me/$—Ç–æ–∫–µ–Ω', 'info');
            log('3. –û—Ç–∫—Ä—ã—Ç—å –µ—ë —á–µ—Ä–µ–∑ tg.openInvoice()', 'info');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-—Å—Å—ã–ª–∫—É
            tg.showPopup({
                title: '–î–µ–º–æ-—Ä–µ–∂–∏–º',
                message: '–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã Telegram Stars',
                buttons: [{type: 'ok'}]
            });
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –æ–ø–ª–∞—Ç—É –¥–ª—è —Ç–µ—Å—Ç–∞
            setTimeout(() => {
                if (confirm('–ò–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—É—é –æ–ø–ª–∞—Ç—É?')) {
                    updateBalance(stars + 1);
                    log('‚úÖ –î–ï–ú–û: –ó–≤–µ–∑–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                }
            }, 500);
        };
        
        // –ü–û–¢–†–ê–¢–ò–¢–¨ –ó–í–ï–ó–î–£
        document.getElementById('spendBtn').onclick = () => {
            if (stars < 1) {
                log('‚ùå –ù–µ—Ç –∑–≤–µ–∑–¥! –°–Ω–∞—á–∞–ª–∞ –∫—É–ø–∏—Ç–µ', 'error');
                return;
            }
            updateBalance(stars - 1);
            log('‚úÖ –ó–≤–µ–∑–¥–∞ –ø–æ—Ç—Ä–∞—á–µ–Ω–∞!', 'success');
        };
        
        // –ü–†–û–í–ï–†–ò–¢–¨
        document.getElementById('checkBtn').onclick = () => {
            log(`üí∞ –ë–∞–ª–∞–Ω—Å: ${stars} ‚≠êÔ∏è`);
        };
        
        log('üëã –¢–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω');
        log('‚ÑπÔ∏è –≠—Ç–æ –î–ï–ú–û-—Ä–µ–∂–∏–º –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π');
        
    </script>
</body>
</html>
