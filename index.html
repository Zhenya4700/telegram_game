<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–ø–∞–ª–∫–∞ —á–ª–µ–Ω–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(145deg, #1a1e2c 0%, #2a2f42 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            color: white;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 48px;
            padding: 32px 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 90%;
            max-width: 380px;
            text-align: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff99cc, #b3d9ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: #1a1e2c;
        }

        .username {
            font-weight: 600;
            flex: 1;
            text-align: left;
            font-size: 16px;
        }

        .user-status {
            font-size: 12px;
            color: #4caf50;
            background: rgba(76, 175, 80, 0.2);
            padding: 4px 8px;
            border-radius: 20px;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ff99cc, #b3d9ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tap-area {
            width: 200px;
            height: 200px;
            margin: 15px auto 20px;
            background: radial-gradient(circle at 30% 30%, #ffd966, #e68a2e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 15px 0 #b3540b, 0 20px 30px rgba(0, 0, 0, 0.6), inset 0 -5px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            border: 3px solid #ffb347;
        }

        .tap-area:active {
            transform: translateY(8px);
            box-shadow: 0 8px 0 #b3540b, 0 15px 25px rgba(0, 0, 0, 0.6);
        }

        .tap-area.cooldown {
            opacity: 0.6;
            filter: grayscale(50%);
            cursor: not-allowed;
            pointer-events: none;
            transform: translateY(5px);
            box-shadow: 0 8px 0 #7a4a1f, 0 15px 20px rgba(0,0,0,0.5);
            animation: none;
        }

        .tap-area.ready {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 #ffd966, 0 15px 0 #b3540b; }
            70% { box-shadow: 0 0 0 20px rgba(255, 215, 0, 0), 0 15px 0 #b3540b; }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0), 0 15px 0 #b3540b; }
        }

        .size-display {
            font-size: 4rem;
            font-weight: 900;
            color: #ffe484;
            text-shadow: 0 3px 0 #b3540b, 0 5px 15px black;
            line-height: 1;
            margin-bottom: 5px;
        }

        .size-label {
            font-size: 1.5rem;
            font-weight: 600;
            color: #f5c6a0;
            margin-bottom: 5px;
            text-transform: lowercase;
        }

        .change-indicator {
            font-size: 2rem;
            font-weight: bold;
            min-height: 50px;
            margin: 5px 0;
        }

        .positive { color: #4caf50; text-shadow: 0 0 10px #4caf50; }
        .negative { color: #f44336; text-shadow: 0 0 10px #f44336; }

        .timer-text {
            font-size: 1.3rem;
            background: rgba(0, 0, 0, 0.4);
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-block;
            color: #aaa;
            border: 1px solid #444;
            margin: 15px 0;
            font-family: monospace;
            letter-spacing: 2px;
        }

        .timer-text.active {
            color: #ffd966;
            border-color: #ffd966;
            box-shadow: 0 0 15px #ffb347;
        }

        .loading {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #1a1e2c;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            z-index: 1000;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #3a3f55;
            border-top-color: #ffd966;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        footer {
            margin-top: 20px;
            font-size: 0.8rem;
            color: #6a6f84;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
    </div>

    <div class="game-container" id="gameContent" style="display: none;">
        <div class="user-info">
            <div class="avatar" id="avatar">üë§</div>
            <div class="username" id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="user-status" id="userStatus">‚ö° –æ–Ω–ª–∞–π–Ω</div>
        </div>

        <h1>‚ö° MEM-–º–µ—Ç—Ä ‚ö°</h1>

        <div class="tap-area" id="tapCircle"></div>
        
        <div class="size-display" id="sizeValue">0</div>
        <div class="size-label">—Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–æ–≤</div>
        <div class="change-indicator" id="changeIndicator"></div>
        
        <div class="timer-text" id="timerDisplay">‚ö° –≥–æ—Ç–æ–≤ ‚ö°</div>

        <footer>—Ç–∞–ø–∞–π —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É</footer>
    </div>

    <script>
        // Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        
        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        let user = tg.initDataUnsafe?.user;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const loading = document.getElementById('loading');
        const gameContent = document.getElementById('gameContent');
        const avatar = document.getElementById('avatar');
        const usernameEl = document.getElementById('username');
        const sizeEl = document.getElementById('sizeValue');
        const changeEl = document.getElementById('changeIndicator');
        const timerEl = document.getElementById('timerDisplay');
        const circle = document.getElementById('tapCircle');
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let size = 0;
        let lastClickTime = 0;
        let cooldown = false;
        let timerInterval = null;
        let userInitialized = false;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –≤ Telegram
        if (!user) {
            // –î–µ–º–æ-—Ä–µ–∂–∏–º –¥–ª—è —Ç–µ—Å—Ç–∞ –≤–Ω–µ Telegram
            usernameEl.textContent = '–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º';
            avatar.textContent = 'üë§';
            loading.style.display = 'none';
            gameContent.style.display = 'block';
            userInitialized = true;
            loadFromLocalStorage();
        } else {
            // –†–µ–∂–∏–º Telegram
            usernameEl.textContent = user.first_name || user.username || '–ò–≥—Ä–æ–∫';
            avatar.textContent = (user.first_name ? user.first_name[0] : 'üë§').toUpperCase();
            loading.style.display = 'none';
            gameContent.style.display = 'block';
            loadFromCloud();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Cloud Storage Telegram
        async function loadFromCloud() {
            try {
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                tg.CloudStorage.getItem('memberSize', (error, value) => {
                    if (error) {
                        console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                        size = 0;
                    } else {
                        size = value ? parseInt(value) : 0;
                    }
                    
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–ª–∏–∫–∞
                    tg.CloudStorage.getItem('lastClick', (err, timeValue) => {
                        if (!err && timeValue) {
                            lastClickTime = parseInt(timeValue);
                            checkCooldown();
                        }
                        updateSize();
                        userInitialized = true;
                    });
                });
            } catch (e) {
                console.log('Cloud Storage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º LocalStorage');
                loadFromLocalStorage();
            }
        }
        
        // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç: LocalStorage
        function loadFromLocalStorage() {
            size = localStorage.getItem('memberSize') ? parseInt(localStorage.getItem('memberSize')) : 0;
            lastClickTime = localStorage.getItem('lastClick') ? parseInt(localStorage.getItem('lastClick')) : 0;
            checkCooldown();
            updateSize();
            userInitialized = true;
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Cloud Storage
        function saveToCloud() {
            if (!user) {
                // –†–µ–∂–∏–º –±–µ–∑ Telegram
                localStorage.setItem('memberSize', size.toString());
                localStorage.setItem('lastClick', lastClickTime.toString());
                return;
            }
            
            try {
                tg.CloudStorage.setItem('memberSize', size.toString(), (error) => {
                    if (error) console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞:', error);
                });
                tg.CloudStorage.setItem('lastClick', lastClickTime.toString(), (error) => {
                    if (error) console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏:', error);
                });
            } catch (e) {
                // –ï—Å–ª–∏ Cloud Storage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('memberSize', size.toString());
                localStorage.setItem('lastClick', lastClickTime.toString());
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞ (1 —Å–µ–∫—É–Ω–¥–∞)
        function checkCooldown() {
            const now = Date.now();
            const timeSinceLastClick = (now - lastClickTime) / 1000;
            
            if (timeSinceLastClick < 1 && lastClickTime > 0) {
                // –í—Å–µ –µ—â–µ –Ω–∞ –∫—É–ª–¥–∞—É–Ω–µ
                const remainingTime = 1 - timeSinceLastClick;
                startCooldown(remainingTime);
            } else {
                // –ú–æ–∂–Ω–æ –∫–ª–∏–∫–∞—Ç—å
                circle.classList.remove('cooldown');
                circle.classList.add('ready');
                timerEl.textContent = '‚ö° –≥–æ—Ç–æ–≤ ‚ö°';
                timerEl.classList.remove('active');
                cooldown = false;
            }
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        function startCooldown(seconds) {
            cooldown = true;
            circle.classList.add('cooldown');
            circle.classList.remove('ready');
            
            let timeLeft = seconds;
            
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                
                if (timeLeft <= 0.05) {
                    clearInterval(timerInterval);
                    cooldown = false;
                    circle.classList.remove('cooldown');
                    circle.classList.add('ready');
                    timerEl.textContent = '‚ö° –≥–æ—Ç–æ–≤ ‚ö°';
                    timerEl.classList.remove('active');
                } else {
                    timerEl.textContent = `‚è≥ ${timeLeft.toFixed(1)}—Å`;
                    timerEl.classList.add('active');
                }
            }, 100);
        }
        
        // –ö–ª–∏–∫ –ø–æ –∫—Ä—É–∂–∫—É
        function handleTap() {
            if (!userInitialized) return;
            if (cooldown) return;
            
            const now = Date.now();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–∞ –ª–∏ —Å–µ–∫—É–Ω–¥–∞ (–¥–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞)
            if (lastClickTime > 0) {
                const timeDiff = (now - lastClickTime) / 1000;
                if (timeDiff < 1) {
                    startCooldown(1 - timeDiff);
                    return;
                }
            }
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç -10 –¥–æ +10
            let change = Math.floor(Math.random() * 21) - 10;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ (–º–æ–∂–µ—Ç —É–π—Ç–∏ –≤ –º–∏–Ω—É—Å!)
            size += change;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–ª–∏–∫–∞
            lastClickTime = now;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            saveToCloud();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateSize();
            showChange(change);
            startCooldown(1);
        }
        
        function updateSize() {
            sizeEl.textContent = size;
        }
        
        function showChange(change) {
            if (change > 0) {
                changeEl.innerHTML = `<span class="positive">+${change}</span>`;
            } else if (change < 0) {
                changeEl.innerHTML = `<span class="negative">${change}</span>`;
            } else {
                changeEl.innerHTML = `<span>0</span>`;
            }
            
            setTimeout(() => {
                changeEl.innerHTML = '';
            }, 800);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        circle.addEventListener('click', handleTap);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
        window.addEventListener('beforeunload', function() {
            saveToCloud();
        });
    </script>
</body>
</html>
